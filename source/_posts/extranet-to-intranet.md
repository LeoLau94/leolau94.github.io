---
title: 如何从外部网访问内部网的服务器
date: 2018-02-06 22:29:37
tags: [teamviewer,ccproxy,proxifier]
category: 使用教程
---
相信大家都是选择使用远程控制内部网的一台机子，来实现这个功能的。但是我想对这种方式并不是特别满意，尤其是当我只是需要使用服务器的资源，至于其他的东西，我本地的机子都可以满足。因此，我一直都很渴望能够使用relay的方式来实现访问。
以下将要介绍如何使用**teamviewer** + **ccproxy** + **proxifier**来实现这个想法，所以，也多谢这几个软件，使得我无需直面真正的技术难题，功劳应当是它们的。
<!-- more -->

+ 需要的设备：一台在内部网的计算机**B**，一台用于主控的外部网的计算机**A**。
+ 教程使用的系统：Windows 10
+ 需要的软件：teamviewer,ccproxy,proxifier(这货好像被功夫网屏蔽了不少链接，不过你也可以使用系统自带的代理设置来访问搭建的代理服务器。)

# Teamviewer

既然想要使用relay的方式访问，我们首先就要解决内网穿透问题，很幸福，目前实现内网穿透最好的软件就是teamviewer啦，而且而且个人还是免费使用的，就是有至多3个设备接入的限制。不过对于个人来说已经是绰绰有余。

当然咯，我们并不是使用teamviewer的远程控制功能，而是使用它的VPN功能，将我们两部计算机**A（主控）**,**B（位于内部网）**建立起虚拟局域网。teamviewer默认是没有开启这个功能的，需要在安装的时候选择高级设置，然后在下一步中就可以选择安装VPN功能。那么已经安装好teamviewer的小伙伴们又该怎么开启呢，在下图中（`主界面->其他->选项`）选择安装即可。
![](/img/teamviewer_vpn.png)
接下来，在两台计算机上开启teamviewer，相信用过的人都已经轻车熟路了。然后在**A**选择以VPN的形式连接**B**，然后连接建立成功会弹出以下界面，复制虚拟局域网内**B（伙伴）**的IP
![](/img/teamviewer_vpn_connected.png)
当然到这里还是不能保证**A & B**是连同的，所以我们这里使用测试ping选项，来看看远程连接的连通性。一般ping不通的话最省事的招数就是把两个防火墙都关闭了（其实只用关闭一个，因为我不知道你们会把所使用的网络连接归为个人还是公用）—— 这招就跟 `chmod 777` 一个路子……哇哈哈，一点都不精致……扯远了。

---

2/12/2018

精致的做法：一般来说不建议关闭防火墙，所以为了能够ping通，建议在入站规则中启用`文件和打印机共享(回显请求 - ICMPv4-In)`即可。

---

当保证ping通后，我们开始以**B**搭建代理服务器,供**A**访问。

# Ccproxy

又一个傻瓜式的代理服务器搭建软件，非常EZ，要做的事情也不多。
首先在B安装好这个软件，然后`主界面->设置`，将本机的局域网IP地址设置为teamviewer vpn提供的虚拟局域网的IP，如下图
![](/img/ccproxy_setting.png)
最后`主界面->账户`，添加一个如下图的账户
![](/img/ccproxy_account.png)
添加账户是为了接下来使用proxifier建立sock5连接而所需的验证方式,当然，你这步不执行也没关系，哇哈哈。
到这里**B**的工作已经全部完成了。

# Proxifier

使用proxifier，我们就可以使用**B**上的代理服务器啦，首先在`proxifier主界面->Profile->Proxy Server`

---

如果你是在官网下载，那么根据你下载是standard版本（就是需要安装的版本）或者是portable版本，
选择对应的注册码

> 
```
L6Z8A-XY2J4-BTZ3P-ZZ7DF-A2Q9C（Portable Edition）
5EZ8G-C3WL5-B56YG-SCXM9-6QZAP（Standard Edition）
P427L-9Y552-5433E-8DSR3-58Z68（MAC）
```

---

如下图添加代理服务器
![](/img/proxifier_proxy_server.png)
注意，这里会提醒你是否设为默认代理规则的action，选择否。
然后`主界面->Profile->Proxification Rule`，添加代理规则，就像一开始所说，我们就只是要访问内部网的服务器而已，其他的完全不想走任何代理，所以我们如下图添加和设置规则
![](/img/proxifier_proxy_rule.png)
这个规则意思就是，只有访问172.31网段格式的地址，才会使用我们在**B**上搭建代理，这里要根据你们使用的服务器地址设立，因人而异。

到这里基本就完成了配置，然后测试一下，能否远程登陆服务器。
![](/img/ssh_to_server.png)

Perfect！Done！
如果你还有什么问题，可以给我发e-mail，不过如果你是男的，我一般都不会搭理你的。蛤蛤蛤！

这是篇很没有技术含量的教程，也就只能骗骗那些遇事就重启的小女生啦（不错我就是这个目的），还望真大神们不要拆穿我的小把戏。

完。

---

2/7/2018更新

---

在ccproxy的`设置->高级->网络`中，如下图设置，即可解决5分钟闲置连接关闭的问题
![](/img/ccproxy_setting_advanced.png)

---

2/10/2018更新

---

使用teamviewer的过程中发现，如果在连接WiFi的情况下，直接接入网线并关闭WiFi，一定要重新登录一次teamviewer，因为直接使用会导致出现异常而无法正常工作，比如我的直接建立VPN连接后，客户端会掉线并一直无法登录（提示服务器未响应）。

---

3/9/2018更新

---

使用完之后如果不想在服务器端挂载本地代理连接外网时，输入密码连接，那么就可以把账户删除了。
但是切记一定不要只删除账号就完事，一定要还原到以下状态~
否则，尽管可以使用wget来获取网页。。。但是还是无法正常连接外网的。

![](/img/ccproxy_account2.png)